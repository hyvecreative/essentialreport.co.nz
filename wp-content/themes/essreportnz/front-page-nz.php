<?php
/*
Template Name: frontpage-nz
*/
?>
<?php
get_header( ); 
?>

<!-- begin content -->

<div class="hm-header-wrap">	

<div class="chart-wrap-white white-new">
	
<div class="container-fluid er-head-wrap-new">
	<div class="container">
		<div class="row">
			<div class="col">
				<div class="animate__animated animate__fadeInUpSmall animate__delay-1s">
					<h1>The report that keeps your finger on New Zealand’s pulse<span>.</span></h1>
				</div>
			</div>
		</div>
	</div>	
</div>
		
	
<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 490.4 147.4" xml:space="preserve">
	
<g>
	<polyline class="stA" points="-1.6,49.9 6.1,43.5 13.8,52.1 21.5,44.2 29.2,58.5 36.9,54.2 44.5,64.9 52.3,64.9 60,60.6 67.6,58.9 
		75.4,64.9 83.1,58.5 90.7,61.1 98.4,69.2 106.2,72.8 113.8,69.2 121.5,65.5 129.2,72.4 136.9,68.8 144.6,71.3 152.3,62.1 160,66.4 
		167.7,77.7 175.4,79.4 183.1,78.1 190.8,75.1 198.5,77.7 206.2,83.7 213.8,82 221.6,79.8 229.3,83.7 236.9,82.6 244.7,86.3 
		252.4,79.8 260,81.6 267.8,82 275.4,85.4 283.1,84.1 290.9,82 298.5,83.3 306.2,87.7 314,84.1 321.6,81.4 329.3,86.3 337.1,88.4 
		344.7,86.1 352.4,89.1 360.1,75.6 367.8,75.6 375.5,86.3 383.2,83.3 390.9,80.9 398.6,79.8 406.3,77.7 414,79.8 421.7,77.9 
		429.4,86.3 437.1,84.5 444.7,80 452.4,82 460.2,86.5 467.8,79.8 475.5,90.5 483.3,90.3 490.9,86.3 	"/>
	<polyline class="stB" points="-1.6,102.1 6.1,103.4 13.8,99.1 21.5,99.1 29.2,94.8 36.9,105.5 44.5,95.4 52.3,96.9 60,101.2 
		67.6,111.2 75.4,101.2 83.1,109.7 90.7,108.7 98.4,105.5 106.2,100.8 113.8,96.9 121.5,99.3 129.2,87.1 136.9,86.3 144.6,88.4 
		152.3,89.9 160,74.7 167.7,73.5 175.4,81.4 183.1,76 190.8,70.2 198.5,79.8 206.2,78.1 213.8,73.5 221.6,82 229.3,76.9 236.9,77.7 
		244.7,77.7 252.4,77.7 260,84.1 267.8,75.6 275.4,77.7 283.1,77.7 290.9,82 298.5,73 306.2,69.8 314,82 321.6,76.5 329.3,75.6 
		337.1,82 344.7,72.6 352.4,77.3 360.1,78.6 367.8,77.7 375.5,79.8 383.2,83.3 390.9,82.4 398.6,84.1 406.3,84.1 414,79.8 
		421.7,78.8 429.4,79.8 437.1,80.7 444.7,81.4 452.4,77.7 460.2,80.5 467.8,82 475.5,79.8 483.3,85.6 490.9,82 	"/>
	<polyline class="stC" points="-1.6,139.8 6.1,139.6 13.8,137.5 21.5,141.6 29.2,139.6 36.9,139.6 44.5,138.6 52.3,141.8 60,143.9 
		67.6,136.3 75.4,139.6 83.1,141.8 90.7,143.1 98.4,137.5 106.2,138.4 113.8,137.5 121.5,141.4 129.2,133.5 136.9,133.9 
		144.6,137.5 152.3,136.3 160,143.3 167.7,137.5 175.4,130.3 183.1,136.7 190.8,138.8 198.5,139.6 206.2,136 213.8,135.4 
		221.6,135.4 229.3,139 236.9,138.6 244.7,137.5 252.4,137.5 260,136.5 267.8,139.6 275.4,135.6 283.1,137.5 290.9,137.5 
		298.5,141.4 306.2,136.5 314,137.5 321.6,140.1 329.3,137.5 337.1,137.5 344.7,139.4 352.4,134.1 360.1,139.4 367.8,141.8 
		375.5,133.2 383.2,140.1 390.9,144.6 398.6,133.2 406.3,139.6 414,137.5 421.7,142.4 429.4,137.5 437.1,141.8 444.7,139.4 
		452.4,141.8 460.2,136 467.8,141.8 475.5,139.6 483.3,137.7 490.9,135.4 	"/>
	<polyline class="stD" points="-1.6,140.5 6.1,139.6 13.8,139.6 21.5,142 29.2,137.5 36.9,133.2 44.5,133 52.3,129 60,129 
		67.6,124.9 75.4,126.8 83.1,122.5 90.7,121.3 98.4,120.4 106.2,122.8 113.8,126.8 121.5,122.5 129.2,134.1 136.9,132.2 
		144.6,133.2 152.3,139.6 160,142.6 167.7,139.6 175.4,132.8 183.1,138.8 190.8,143.1 198.5,141.8 206.2,133.5 213.8,141.8 
		221.6,139.6 229.3,136.7 236.9,135.4 244.7,133.2 252.4,135.4 260,133.2 267.8,137.5 275.4,130.2 283.1,137.5 290.9,133.2 
		298.5,136.7 306.2,135.4 314,135.4 321.6,135.6 329.3,133.2 337.1,133.2 344.7,134.5 352.4,133.7 360.1,133.9 367.8,135.4 
		375.5,135.4 383.2,131.8 390.9,136.9 398.6,133.2 406.3,131.1 414,135.4 421.7,136.5 429.4,135.4 437.1,129.6 444.7,133.7 
		452.4,133.2 460.2,129.6 467.8,133.2 475.5,131.1 483.3,128.6 490.9,131.1 	"/>
</g>

</svg>
	
	
</div> <!-- end chart wrap -->
	
	<div class="container-fluid intro-panel-new" style="margin-top: 2rem;">
	<div class="container">
		<div class="row">
			
			<div class="col-lg-6 intro-text"> 
				<h2 class=""><?php the_field('banner_head') ?></h2>
	        	<?php the_field('banner_para') ?>
				<div style="margin-right: .5rem;" class="btn btn-yellow btn-subscribe"><?php the_field('banner_but_text') ?> <i class="fas fa-chevron-down" aria-hidden="true"></i></div>
				<a class="btn" href="<?php the_field('banner_but_url_2') ?>"><?php the_field('banner_but_text_2') ?> <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
			</div>
			
			<div class="col-lg-6 intro-image"> 
				<div class="intro-image-wrap"><img src="<?php bloginfo('template_directory'); ?>/images/montage.png" alt="Political Insights" /></div>
			</div>
		</div>
	</div>
	</div>

</div> <!-- end hm-header -->
	
<div id="latest-reports" class="container-fluid latest-reports-hm" style="padding: 2rem 0">		
	<div class="container">
		<div class="row">
			
			
			<div class="col-sm-12 col-md-10 offset-md-1">
				
				<h2 class="report-title text-center">Latest Essential Report</h2>
				
				<?php 
					$args = array(  
						'post_type' => 'reports',
						'post_status' => 'publish',
						'posts_per_page' => 1, 
						'order_by' => 'title', 
						'order' => 'DESC',
					); 

				$loop = new WP_Query( $args ); 

				while ( $loop->have_posts() ) : $loop->the_post();

				the_title( '<h3 class="report-date text-center">', '</h3>' ); 
				?>
				
				<div class="col-sm-12 key-insights" 
					 <?php $insights = get_field('turn_on_insights');
if( $insights && in_array('show', $insights) ) { ?>
    style="display: block;"
<?php } ?> >
				<h3 class="report-title text-center">Key Insights</h3>
					<ul>
						<?php if( have_rows('key_insights') ): while ( have_rows('key_insights') ) : the_row(); ?>
						<li><span><?php the_sub_field('insight_text') ?></span></li>
						<?php endwhile; else: endif; ?>
					</ul>
				</div>


					<div class="entry-content">
						
						<div class="col-sm-12 text-center" style="margin-bottom: 1rem;">
				
							<button id="toggleAccordion" type="button" class="btn btn-orange">Open all questions <i class="fas fa-chevron-down" aria-hidden="true"></i></button>

						</div>
						
						<?php the_content(); ?>
						<?php
				$featured_posts = get_field('report_questions');
				if( $featured_posts ): ?>
					<div id="accordion" class="accordion-wrap" style="padding-left: 0;">
						
						<?php $count = 1; ?>
						<?php $count2 = 1; ?>
						
					<?php foreach( $featured_posts as $post ): 

						// Setup this post for WP functions (variable must be named $post).
						setup_postdata($post); ?>
						
						<div class="card report-list" style="margin-bottom: .5rem;">
							
							<div class="card-header">
								<a class="collapsed card-link" data-toggle="collapse" href="#collapse-<?php echo $count; $count++; ?>"><?php the_title(); ?>
								<i class="fas fa-chevron-down" aria-hidden="true"></i> </a>
							</div>
							
							<div id="collapse-<?php echo $count2; $count2++; ?>" class="collapse" data-_disabled_parent="#accordion"> <!-- Disabled data parent to prevent closing of others when one is shown  -->
							  <div class="card-body">
								 <div class="cat-wrap">
									<span class="category">
										
										<!-- start list questions categories --> 

											  <?php           
											  $product_terms = wp_get_object_terms( $post->ID,  'question_categories' );
												  if ( ! empty( $product_terms ) ) {
												  if ( ! is_wp_error( $product_terms ) ) {
												  foreach( $product_terms as $term ) {
												  echo '<a class="' . $term->slug .'" href="' . get_term_link( $term->slug, 'question_categories' ) . '">' . esc_html( $term->name ) . '</a>, '; 
												  }

												}
											  } ?>
										<!-- end  list questions categories --> 

									</span>
									 
									 <span class="category tag-display"><?php the_tags(' '); ?></span>
									 
								  </div>
								  
								  <div class="question-content">
										<?php the_content(); ?>
								  </div>
								
								<div class="question-charts charts-buttons" style="overflow: hidden;"> 
									
									
								<?php $active = 1; ?>
								<?php $active2 = 1; ?>
									
								<?php if( have_rows('question_charts') ): while ( have_rows('question_charts') ) : the_row(); ?>
										
                  <div class="btn btn-question quest-<?php //echo $active; $active++; ?>" data-q="<?php echo $active; $active++; ?>"><?php the_sub_field('button_text'); ?></div>

                  <?php endwhile; else: endif; ?>
        
                  </div>  <!-- end question charts -->
								  
                  <div class="question-charts chart-content" style="padding: .5rem 0;"> 
        
                  <?php if( have_rows('question_charts') ): while ( have_rows('question_charts') ) : the_row(); ?>

                    <div class="question-show quest-show-<?php //echo $active2; $active2++; ?>" data-q="<?php echo $active2; $active2++; ?>">
                    
                    <?php //the_sub_field('question_content'); ?>

                    <?php

                    // get iframe HTML
                    $iframe = get_sub_field('question_content');
                    // use preg_match to find iframe src
                    preg_match('/src="(.+?)"/', $iframe, $matches);
                    $src = $matches[1];

                    // add extra params to iframe src
                    $params = array(
                      // NA
                    );

                    $new_src = add_query_arg($params, $src);

                    $iframe = str_replace($src, $new_src, $iframe);

                    // add extra attributes to iframe html
                    $attributes = 'loading="lazy"';
                    // use preg_replace to change iframe src to data-src
                    $iframe = preg_replace('~<iframe[^>]*\K(?=src)~i','data-',$iframe);
                    $iframe = str_replace('></iframe>', ' ' . $attributes . '></iframe>', $iframe);

                    // echo $iframe
                    echo $iframe;

                    ?>
                  
                    </div>

                  <?php endwhile; else: endif; ?>
        
                  </div>  <!-- end question charts -->
                    
					<!-- start question share -->
						<a class="copyToClipboard" style="font-size: .875rem; text-decoration: underline; cursor:pointer; margin-right: .5rem;" onclick="copyToClipboard('<?php echo get_permalink($post->ID);?>') ? this.innerText='Copied!': this.innerText='Sorry :(' ">Copy the direct link to this question</a>
								  
			        <!-- end question share-->
								  
					<!-- Your share button code -->
								  
						<?php the_permalink; ?>
								  
						<div class="fb-share-button" data-href="<?php echo get_permalink($post->ID);?>" data-layout="" data-size=""><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=<?php the_permalink; ?>%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>
					<!-- Your share button code -->
								  
								  
					</div> <!-- end card body-->
    				</div>
							
					</div>						
						
					<?php endforeach; ?>
					</div>
					<?php 
					// Reset the global post object so that the rest of the page works correctly.
					wp_reset_postdata(); ?>
				<?php endif; ?>
					</div>

				<?php endwhile; ?>
				
			</div>	
			
			<div class="col-sm-12 report-btns text-center" style="padding-top: 2rem"> 
					
			<a style="margin: 0 .5rem 1rem;" class="btn" href="/reports/">View previous reports <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
			<a style="margin: 0 .5rem 1rem;" class="btn" href="/search/">Explore the full archive <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
			<a style="margin: 0 .5rem 1rem;" class="btn" href="/methodology/">Essential Report Methodology <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
			
			
			</div>
	
			
		</div>
	</div>
</div>

<div class="container-fluid bar-chart">	
	<div class="arrow-down"></div>
	<div class="container">
		<div class="row">
			
			<div class="col-sm-12 col-lg-10 offset-lg-1 text-center form-wrap"> 
				<h2><?php the_field('subscribe_title') ?></h2>
				<p><?php the_field('subscribe_text') ?></p>
				
				<?php gravity_form( 1, false, false, false, '', true, false ); ?>
				
				<div class="priv-dark"><?php the_field('collection_statement', 'option'); ?></div>
			</div>
			
			<figure id="figure">
					  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 220 177.8" style="enable-background:new 0 0 220 177.8;" xml:space="preserve">
<style type="text/css">
	.st10{fill:#275764;}
	.st11{fill:none;stroke:#0c4755;stroke-width:44;stroke-miterlimit:10;}
	.st12{fill:none;stroke:#1c4f5c;stroke-width:44;stroke-miterlimit:10;}
	.st13{fill:none;stroke:#275764;stroke-width:44;stroke-miterlimit:10;}
	.st14{fill:none;stroke:#013f51;stroke-width:44;stroke-miterlimit:10;}
	.st15{fill:none;stroke:#0c4755;stroke-width:44;stroke-miterlimit:10;}
</style>
<path class="st10" d="M109.5,0"/>
<g class="flag move-up">
	<rect x="109.5" y="91.6" class="st10" width="0.9" height="0.4"/>
	<path class="st10" d="M110.4,92.9c0,0,2.7,0.1,3,0.2c0.2,0,0.6,0.2,0.8,0.2c0.1,0,0.2,0,0.2,0c0.1,0,0.3-0.1,0.5,0
		c0.3,0.1,0.9,0.2,0.9,0.2l1,0.2c0,0,0,0,0.5,0.1s1.1,0.5,1.1,0.5l0.1,0.2c0,0,0,0.2,0,0.5c0,0.3,0.2,0.7,0.2,0.8c0,0.2,0,0.4,0,0.4
		s0,1.2-0.1,1.2c-0.1,0.1-2.8,0.1-3.4,0c-0.6,0-3.3,0-3.6,0.1c-0.4,0.1-1.1,0.3-1.1,0.3s0.3-2.9,0.2-3.2
		C110.7,94,110.4,92.9,110.4,92.9z"/>
	<rect x="109.8" y="92.4" class="st10" width="0.4" height="28"/>
	<path class="st10" d="M108.2,102.7h-1.4l0.4,1.7v11.2l-17.7,15.1c0.3,0.3,0.6,0.6,0.9,0.9h0.1l13.6-11.3l-10.8,14
		c0.4,0.3,0.8,0.6,1.2,0.8l13.7-18.7l0,0l0,0V115h0.8v-0.9h-0.8v-5.9h0.8v-0.9h-0.8C108.2,107.3,108.2,102.7,108.2,102.7z"/>
	<path class="st10" d="M112.8,115.6v-11.2l0.4-1.7h-1.4v4.6h-0.9v0.9h0.9v5.9h-0.9v0.9h0.9v1.5l0,0l0,0l13.7,18.7
		c0.4-0.3,0.8-0.5,1.1-0.8l-10.7-14l13.7,11.4l0,0c0.3-0.3,0.6-0.6,0.9-1L112.8,115.6z"/>
</g>
<line class="st11" x1="22" y1="177.8" x2="22" y2="122.1"/>
<line class="st12" x1="66" y1="177.8" x2="66" y2="108.2"/>
<line class="st13" x1="110" y1="177.8" x2="110" y2="37.7"/>
<line class="st14" x1="154" y1="177.8" x2="154" y2="82"/>
<line class="st15" x1="198" y1="177.8" x2="198" y2="161.8"/>
</svg>
			</figure>
			
		</div>
	</div>
</div>

<div class="container-fluid political-insights"  style="padding-top: 0;">
	
		<div class="arrow-down arrow_insights" style="border-top: 40px solid #083444; margin: 0 auto;"></div>

	<div class="container">
		<div class="row">
			
			<div class="col-sm-12 insight-blocks text-center">
				<h2><?php the_field('political_insights_title') ?></h2>
				<p style="max-width: 700px; margin: 1rem auto 2rem"><?php the_field('political_insights_text') ?></p>
				
				<div class="row text-left" style="margin-bottom: 1rem">
					<div class="col-sm-12" style="margin-bottom: 1rem;">
						<div class="col-sm-12 insight-frame" style="background: #fff;">
							<?php the_field('pi_chart_content') ?>
						</div>
						<div class="col-sm-12 insight-link">

						</div>
					</div>
									
				</div>
				
				<a class="btn btn-dark" href="<?php the_field('pi_button_url') ?>"><?php the_field('pi_button_text') ?>  <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
				
			</div>
	</div>
</div>
<img class="port-pm" src="<?php bloginfo('template_directory'); ?>/images/peter-dutton.png" alt="Peter Dutton" />
<img class="port-opp" src="<?php bloginfo('template_directory'); ?>/images/anthony-albanese.png" alt="Anthony Albanese" />
</div>

<!-- end Political Insights -->

<div class="container-fluid client-projects projects-wrap" style="padding-top: 0;">
	
	<div class="arrow-down arrow_insights" style="margin-bottom: 0;"></div>
	
	<div class="container">  <!-- new content -->
		
		<div class="row members-content">
			
			<div class="col-12 project-intro-cont text-center">
				<h2><?php the_field('project_title') ?></h2>
				<?php the_field('project_intro') ?>
				<a style="margin-top: 0; margin-bottom: 1.5rem;" class="btn" href="<?php the_field('client_but_url') ?>"><?php the_field('client_but_text') ?> <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
			</div>
	
	<?php // The WordPress Loop 0- customized with query_posts
	query_posts('post_type=client_projects&showposts=4&orderby=title&order=asc');?> 
	<?php if (have_posts()) : while (have_posts()) : the_post(); ?>

	

		<!-- begin storypost -->

			<div class="col-lg-6 project-feed" >
				
				<div class="project-feed-wrap">

				<a style="display: inline-block; margin-left: -1.5rem; margin-right: -1.5rem;" href="<?php the_permalink() ?>">

				<?php if ( has_post_thumbnail() ) {
												the_post_thumbnail(array( ));
												} else { ?>
												<img src="<?php bloginfo('template_directory'); ?>/images/default-member-image.jpg" alt="<?php the_title(); ?>" />
												<?php } ?>

				</a>

				<h3><a href="<?php the_permalink() ?>"><?php the_title(); ?></a></h3>

				<div class="excerpthm" style="color: #333;">
					<p><?php the_excerpt(); ?></p>
				</div>

			 </div><!-- END feedcont-->

			</div>

	<?php endwhile; else:

	endif;
	wp_reset_query(); // reset the query
	?>		
	</div>  <!-- end row -->
</div> <!-- end new content  -->	
</div> <!-- end new content  -->


<div class="container-fluid insights-related" style="padding-top: 0;">
	<div class="arrow-down" style="margin-bottom: 2rem; border-top: 40px solid #fff;"></div>
 
	<div class="container">
		<div class="row">
			
		 <div class="col-lg-6" style="margin-bottom: 1.5rem;">
			 
			 <h3><?php the_field('poll_position_title') ?></h3>
			 
			 <div class="row">
			 
			 <div class="col-sm-6">
				 <?php 
				$image = get_field('poll_position_image');
				if( !empty( $image ) ): ?>
					<img src="<?php echo esc_url($image['url']); ?>" alt="<?php echo esc_attr($image['alt']); ?>" />
			<?php endif; ?>
			 </div>
			 
			 <div class="col-sm-6 p-position-text">
			 
			 <p style="margin-top: 0;"><?php the_field('poll_position_text') ?></p>
			 
			 
				 
			 </div>
				 
			<div class="col-12">
					 <div class="text-center"><a class="btn btn-dark" href="<?php the_field('pp_button_url') ?>"><?php the_field('pp_button_text') ?> <i class="fas fa-chevron-right" aria-hidden="true"></i></a></div>
			 </div>
				 
				 
			</div>
			 
			</div>
			
		<div class="col-lg-6">
			
			<h3><?php the_field('policical_analysis_title') ?></h3>
			
			  <?php 
				$image = get_field('analysis_pic');
				if( !empty( $image ) ): ?>
					<img src="<?php echo esc_url($image['url']); ?>" alt="<?php echo esc_attr($image['alt']); ?>" />
			  <?php endif; ?>
			
			<p class="image-credit"><?php the_field('image_credit') ?></p>
			
			<div class="text-center" style="margin-top: .5rem;"><a class="btn btn-dark" href="<?php the_field('pa_button_url') ?>"><?php the_field('pa_button_text') ?> <i class="fas fa-chevron-right" aria-hidden="true"></i></a></div>
		</div>
			
		</div>
	</div>
</div>


<div class="container-fluid subscribe" style="padding-top: 0;">	
	
	<div class="arrow-down"></div>

	<div class="container">
		<div class="row">
			
			
			
			<div class="col-sm-12 text-center form-wrap"> 
				<h2><?php the_field('purchase_title') ?></h2>
				<h3><?php the_field('purchase_sub_head') ?></h3>
				<p><?php the_field('purchase_text') ?></p>
				
				
			</div>
			
			<div class="col-sm-12 text-center">
			
			<a class="btn btn-yellow" href="<?php the_field('pur_button_url') ?>"><?php the_field('pur_button_text') ?> <i class="fas fa-chevron-right" aria-hidden="true"></i></a>
				
			</div>
			
			<figure class="pie-large">
					<svg id="mysvg" viewBox="0 0 63.6619772368 63.6619772368">
						<circle class="pie1" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie2" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie3" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie4" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
					  </svg>
			</figure>
			
			<figure class="pie-small">
					<svg id="mysvg2" viewBox="0 0 63.6619772368 63.6619772368">
						<circle class="pie5" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie6" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie7" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie8" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
						<circle class="pie9" cx="31.8309886184" cy="31.8309886184" r="15.9154943092"/>
					</svg>
			</figure>
			
		</div>
	</div>
</div>




<div class="container-fluid news-wrap">
	<div class="container">
		<div class="col-12 text-center">
			<h2>In the News</h2>
		</div>
			<div class="col-12">
			<?php get_template_part( 'partials/content', 'news-feed' ); ?>
		</div>
	</div>
</div>

<div class="container-fluid purchase-spruik" style="display: none; padding: 6rem 0 7rem;">	
	<div class="container">
		<div class="col-12 text-center">
			<h2>Essential Spruik</h2>
			<p>Content...</p>
			<a class="btn btn-banner" href="#">Visit Essential</a>
		</div>
	</div>
</div>


 <!-- end Join wrap -->

<script>

$(document).ready(function(){

  
  /* Open All Accordions */

  $("#toggleAccordion").on('click', function(){
    if ($(this).data("closedAll")) {
      $('#accordion .collapse').collapse('show'); // Show All using bootstrap collapse method
      $('#toggleAccordion').html('Close all questions <i class="fas fa-chevron-up" aria-hidden="true"></i>'); // Change button text

      // Loop all questions, add active and set src
      $( ".chart-content .question-show:first-child" ).each(function( index ) {
        $(this).addClass('active');
        var iframeSrc = $(this).find('iframe').data('src'); // Get the src from the data attribute
        $(this).find('iframe').attr('src', iframeSrc); // Apply the src to iframe to trigger it to load
      });
          
    }
    else {
      $('#accordion .collapse').collapse('hide'); // Hide All using bootstrap collapse method
      $('#toggleAccordion').html('Open all questions <i class="fas fa-chevron-down" aria-hidden="true"></i>'); // Change button text
    }

    // save last state
    $(this).data("closedAll", !$(this).data("closedAll")); 
  });

  // init with all closed
  $("#toggleAccordion").data("closedAll", true);


  
  /* Open Single Accordion */

  // Handled by Bootstrap Collapse component, Callback required to set 1st question active and set iframe src
  $('#accordion').on('show.bs.collapse', function (e) {

    console.log(e.target);

    // add active and set src
    var firstQues = $(e.target).find( ".chart-content .question-show:first-child" ); // Get the first ques elem in this set
    firstQues.addClass('active'); // Set it as active
    var iframeSrc = firstQues.find('iframe').data('src'); // Get the src from the data attribute 
    firstQues.find('iframe').attr('src', iframeSrc); // Apply the src to iframe to trigger it to load

  })


	/* Toggle Individual Questions */

  jQuery('.btn-question').on('click', function () {

    var quesNum = $(this).data('q'); // Get the ques number we are opening
    //console.log('Q# = ' + quesNum);
    var quesThis = $(this).parent('.charts-buttons').next('.chart-content').children('.question-show[data-q="' + quesNum + '"]'); // Get the ques elem for this ques num
    var quesAll = $(this).parent('.charts-buttons').next('.chart-content').children('.question-show'); // Get all ques elems in this set

    quesAll.removeClass('active'); // Close all sibling questions
    quesThis.addClass('active'); // Activate this question

    var iframeSrc = quesThis.find('iframe').data('src'); // Get the src from the data attribute
    quesThis.find('iframe').attr('src', iframeSrc); // Apply the src to iframe to trigger it to load
    
  });

});


</script>

<style>

body .question-show.active {
    max-height: 2000px;
    opacity: 1;
    transition: opacity 300ms ease-in-out 700ms, max-height 0s linear 300ms;
}

body .question-show {
    display: block;
    max-height: 0;
    overflow: hidden;
    opacity: 0;
    transition: opacity 300ms ease-in-out 0s, max-height 0s linear 300ms;
}

</style>

<script>/**
 * Copy a string to clipboard
 * @param  {String} string         The string to be copied to clipboard
 * @return {Boolean}               returns a boolean correspondent to the success of the copy operation.
 * @see https://stackoverflow.com/a/53951634/938822
 */
	
function copyToClipboard(string) {
  let textarea;
  let result;

  try {
    textarea = document.createElement('textarea');
    textarea.setAttribute('readonly', true);
    textarea.setAttribute('contenteditable', true);
    textarea.style.position = 'fixed'; // prevent scroll from jumping to the bottom when focus is set.
    textarea.value = string;

    document.body.appendChild(textarea);

    textarea.focus();
    textarea.select();

    const range = document.createRange();
    range.selectNodeContents(textarea);

    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);

    textarea.setSelectionRange(0, textarea.value.length);
    result = document.execCommand('copy');
  } catch (err) {
    console.error(err);
    result = null;
  } finally {
    document.body.removeChild(textarea);
  }

  // manual copy fallback using prompt
  if (!result) {
    const isMac = navigator.platform.toUpperCase().indexOf('MAC') >= 0;
    const copyHotkey = isMac ? '⌘C' : 'CTRL+C';
    result = prompt(`Press ${copyHotkey}`, string); // eslint-disable-line no-alert
    if (!result) {
      return false;
    }
  }
  return true;
}

	
</script>


<?php get_footer(); ?>